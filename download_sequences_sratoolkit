### this code was executed on the Linux server termianl ###

#################################### the first setp is to install conda ####################################

wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh 
chmod +x Miniconda3-latest-Linux-x86_64.sh 
~/miniconda3/bin/condaÂ init
source ~/.bashrc

#################################### create enviroment ####################################

# once we installed conda, the next step is to create an enviroment, in my case a selected the amplicon enviroment. For other systems you can check on the oficial QIIME2 webpage:
https://docs.qiime2.org/2024.10/install/native/#activate-the-conda-environment

# now, on the server's terminal, execute:

conda env create -n qiime2-amplicon-2024.10 --file https://data.qiime2.org/distro/amplicon/qiime2-amplicon-2024.10-py310-linux-conda.yml
# note: be careful to install amplicon enviroment. For example, metagenome enviroment doesn't have all the plugins requiered to process amplicon analysis. 

# activate base conda enviroment 
conda activate qiime2-amplicon-2024.10

# activate amplicon enviroment
conda activate qiime2-amplicon-2024.10

#################################### install sratoolkit ####################################

https://github.com/ncbi/sra-tools/wiki/02.-Installing-SRA-Toolkit

# the next step is to install sratoolkit, so we can download the fastq sequences 
wget --output-document sratoolkit.tar.gz https://ftp-trace.ncbi.nlm.nih.gov/sra/sdk/current/sratoolkit.current-ubuntu64.tar.gz

# extract the file 
tar -vxzf sratoolkit.tar.gz

# corroborate it's been installed
fastq-dump --stdout -X 2 SRR390728

# this must product this output

Read 2 spots for SRR390728
Written 2 spots for SRR390728
@SRR390728.1 1 length=72
CATTCTTCACGTAGTTCTCGAGCCTTGGTTTTCAGCGATGGAGAATGACTTTGACAAGCTGAGAGAAGNTNC
+SRR390728.1 1 length=72
;;;;;;;;;;;;;;;;;;;;;;;;;;;9;;665142;;;;;;;;;;;;;;;;;;;;;;;;;;;;;96&&&&(
@SRR390728.2 2 length=72
AAGTAGGTCTCGTCTGTGTTTTCTACGAGCTTGTGTTCCAGCTGACCCACTCCCTGGGTGGGGGGACTGGGT
+SRR390728.2 2 length=72
;;;;;;;;;;;;;;;;;4;;;;3;393.1+4&&5&&;;;;;;;;;;;;;;;;;;;;;<9;<;;;;;464262


#################################### downloading files ####################################

# this will download a .sra file 
prefetch SRR12689029

# convert into a fastq doc. This will generate two files if is paird end ( _1 forward read and _2 reverse read) or a single .fastq doc if is single end 
fasterq-dump --split-3 SRR12689029.sra

#################################### CASAVA formatting ####################################

# if you need to rename the files to get a CASAVA format
for prefix in SRR12802543 SRR12802544; do
    mv "${prefix}_1.fastq" "${prefix}_111_L001_R1_001.fastq"
    mv "${prefix}_2.fastq" "${prefix}_111_L001_R2_001.fastq"
done

#################################### zip files ####################################

gzip *.fastq

# remove .sra files
rm *.sra
